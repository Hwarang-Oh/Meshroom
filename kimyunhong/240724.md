# 240724 TIL

1. WebSocket과 Kafka의 연결을 통해 채팅을 구현하기 위해 하루종일 시간을 투자했다.
좋은 ref를 찾아서 참고하며 팀원인 경호가 만든 session API와 합치려 했지만 내가 처음부터 만든 코드가 아니다보니 애초에 코드를 이해하는 것부터가 한참이 걸렸다. WebSocket을 실습을 반복하며 이해를 조금 했다는 생각을 하기 시작했는데, 하나의 산을 넘으니 더 높은 산이 나를 기다리고 있었다. 

2. 일단 우리의 채팅 서비스 흐름에 대해 간략하게 설명을 하자면, 우선 RDBMS를 쓰지 않는 우리의 DB특성 상 따로 ROOM의 개념없이 session하나를 하나의 방으로 여긴다. 그리고 openVidu에 대해 연구한 결과 하나의 세션 안에 여러 세션을 만드는 방식이 중앙 통제의 유일한 방식인거 같아 그것을 차용하려 한다. 그러면 흐름 상 일단 User는 하나의 세션에 입장한 상태에서 다음의 세션을 추가로 들어가는 것이다. 비유하자면 큰방에 들어갔다가 작은 방으로 나누어져 들어가는 구조. 그러면 일단 sessionID를 두개씩 들고 있어야 하는거다. 왜냐하면 MainSessionId에다가 SubSessionId까지 들고 있어야 하기 때문에 그리고 우리는 고유의 Id를 통해 session을 구분하며 그곳으로 mapping을 해주면 된다. 일단 흐름은 이해하기 쉬웠는데 pub/sub 구조 하에 Kafka를 응용하기가 생각보다 어렵다... 아직도 이해를 하지 못한 부분이 많다.